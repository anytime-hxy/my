!function(t){t.widget("ui.draggable",t.extend({},t.ui.mouse,{_init:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){this.element.data("draggable")&&(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy())},_mouseCapture:function(e){e.preventDefault();var s=this.options;return this.helper||s.disabled||t(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?!0:!1)},_mouseStart:function(e){e.preventDefault();var s=this.options;return this.helper=this._createHelper(e),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),s.containment&&this._setContainment(),this._trigger("start",e),this._cacheHelperProportions(),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.helper.addClass("ui-draggable-dragging"),this.helper.hasClass("cpt_node")&&(this.helper.addClass("cpt_drag"),t("#whole_cpt,#cover_cpt").hide(),t("#cpt_panel").css("overflow","visible")),this._mouseDrag(e,!0),!0},_mouseDrag:function(e,s){if(e.preventDefault(),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!s){var i=this._uiHash();this._trigger("drag",e,i),this.position=i.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){e.preventDefault(),t("#cpt_panel").css("overflow","hidden");var s=!1;if(t.ui.ddmanager&&!this.options.dropBehaviour&&0==t(".lay_forbid_holder").length&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&0==t(".lay_forbid_holder").length&&(s=this.dropped,this.dropped=!1),"invalid"==this.options.revert&&!s||"valid"==this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)){var i=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e),i._clear()})}else this._trigger("stop",e),this._clear();return!1},_getHandle:function(e){e.preventDefault();var s=this.options.handle&&t(this.options.handle,this.element).length?!1:!0;return t(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(s=!0)}),s},_createHelper:function(e){e.preventDefault();var s=this.options,i=t.isFunction(s.helper)?t(s.helper.apply(this.element[0],[e])):"clone"==s.helper?this.element.clone():this.element;return i.parents("body").length||i.appendTo("parent"==s.appendTo?this.element[0].parentNode:s.appendTo),i[0]==this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){void 0!=t.left&&(this.offset.click.left=t.left+this.margins.left),void 0!=t.right&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),void 0!=t.top&&(this.offset.click.top=t.top+this.margins.top),void 0!=t.bottom&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{var s=t(e.containment)[0];if(!s)return;var i=t(e.containment).offset(),o="hidden"!=t(s).css("overflow");this.containment=[i.left+(parseInt(t(s).css("borderLeftWidth"),10)||0)+(parseInt(t(s).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(s).css("borderTopWidth"),10)||0)+(parseInt(t(s).css("paddingTop"),10)||0)-this.margins.top,i.left+(o?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(t(s).css("borderLeftWidth"),10)||0)-(parseInt(t(s).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(o?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(t(s).css("borderTopWidth"),10)||0)-(parseInt(t(s).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,s){s||(s=this.position);var i="absolute"==e?1:-1,o=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),n=/(html|body)/i.test(o[0].tagName);return{top:s.top+this.offset.relative.top*i+this.offset.parent.top*i-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():n?0:o.scrollTop())*i),left:s.left+this.offset.relative.left*i+this.offset.parent.left*i-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())*i)}},_generatePosition:function(e){e.preventDefault();var s=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(i[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var n=e.pageX,a=e.pageY;if(this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),s.grid)){var r=this.originalPageY+Math.round((a-this.originalPageY)/s.grid[1])*s.grid[1];a=this.containment&&(r-this.offset.click.top<this.containment[1]||r-this.offset.click.top>this.containment[3])?r-this.offset.click.top<this.containment[1]?r+s.grid[1]:r-s.grid[1]:r;var l=this.originalPageX+Math.round((n-this.originalPageX)/s.grid[0])*s.grid[0];n=this.containment&&(l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2])?l-this.offset.click.left<this.containment[0]?l+s.grid[0]:l-s.grid[0]:l}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:i.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:i.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,s,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[s,i]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.widget.prototype._trigger.call(this,e,s,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,absolutePosition:this.positionAbs,offset:this.positionAbs}}})),t.extend(t.ui.draggable,{version:"1.7.1",eventPrefix:"drag",defaults:{addClasses:!0,appendTo:"parent",axis:!1,cancel:":input,option",connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,delay:0,distance:1,grid:!1,handle:!1,helper:"original",iframeFix:!0,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,s){e.preventDefault();var i=t(this).data("draggable"),o=i.options,n=t.extend({},s,{item:i.element});i.sortables=[],t(o.connectToSortable).each(function(){var s=t.data(this,"sortable");s&&!s.options.disabled&&(i.sortables.push({instance:s,shouldRevert:s.options.revert}),s._refreshItems(),s._trigger("activate",e,n))})},stop:function(e,s){e.preventDefault();var i=t(this).data("draggable"),o=t.extend({},s,{item:i.element});t.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,o))})},drag:function(e,s){e.preventDefault();var i=t(this).data("draggable"),o=this;t.each(i.sortables,function(){this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(o).clone().appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return s.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",e),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",e),i.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(e){e.preventDefault();var s=t("body"),i=t(this).data("draggable").options;s.css("cursor")&&(i._cursor=s.css("cursor")),s.css("cursor",i.cursor)},stop:function(e){e.preventDefault();var s=t(this).data("draggable").options;s._cursor&&t("body").css("cursor",s._cursor)}}),t.ui.plugin.add("draggable","iframeFix",{start:function(e){e.preventDefault();var s=t(this).data("draggable").options;t(s.iframeFix===!0?"iframe":s.iframeFix).each(function(){("config_item"==t(this).parent().attr("id")||t(this).parent().hasClass("app_title")||"edit_post"==t(this).attr("id"))&&t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")})},stop:function(){t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}}),t.ui.plugin.add("draggable","opacity",{start:function(e,s){e.preventDefault();var i=t(s.helper),o=t(this).data("draggable").options;i.css("opacity")&&(o._opacity=i.css("opacity")),i.css("opacity",o.opacity)},stop:function(e,s){e.preventDefault();var i=t(this).data("draggable").options;i._opacity&&t(s.helper).css("opacity",i._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(e){e.preventDefault();var s=t(this).data("draggable");s.scrollParent[0]!=document&&"HTML"!=s.scrollParent[0].tagName&&(s.overflowOffset=s.scrollParent.offset())},drag:function(e){var s=t(this).data("draggable"),i=s.options,o=!1;s.scrollParent[0]!=document&&"HTML"!=s.scrollParent[0].tagName?(i.axis&&"x"==i.axis||(s.overflowOffset.top+s.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?s.scrollParent[0].scrollTop=o=s.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-s.overflowOffset.top<i.scrollSensitivity&&(s.scrollParent[0].scrollTop=o=s.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"==i.axis||(s.overflowOffset.left+s.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?s.scrollParent[0].scrollLeft=o=s.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-s.overflowOffset.left<i.scrollSensitivity&&(s.scrollParent[0].scrollLeft=o=s.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"==i.axis||(e.pageY-t(document).scrollTop()<i.scrollSensitivity?o=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(o=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"==i.axis||(e.pageX-t(document).scrollLeft()<i.scrollSensitivity?o=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(o=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e){e.preventDefault();var s=t(this).data("draggable"),i=s.options;s.snapElements=[],t(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var e=t(this),i=e.offset();this!=s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,s){e.preventDefault();for(var i=t(this).data("draggable"),o=i.options,n=o.snapTolerance,a=s.offset.left,r=a+i.helperProportions.width,l=s.offset.top,h=l+i.helperProportions.height,p=i.snapElements.length-1;p>=0;p--){var c=i.snapElements[p].left,f=c+i.snapElements[p].width,d=i.snapElements[p].top,g=d+i.snapElements[p].height;if(a>c-n&&f+n>a&&l>d-n&&g+n>l||a>c-n&&f+n>a&&h>d-n&&g+n>h||r>c-n&&f+n>r&&l>d-n&&g+n>l||r>c-n&&f+n>r&&h>d-n&&g+n>h){if("inner"!=o.snapMode){var u=Math.abs(d-h)<=n,m=Math.abs(g-l)<=n,v=Math.abs(c-r)<=n,P=Math.abs(f-a)<=n;u&&(s.position.top=i._convertPositionTo("relative",{top:d-i.helperProportions.height,left:0}).top-i.margins.top),m&&(s.position.top=i._convertPositionTo("relative",{top:g,left:0}).top-i.margins.top),v&&(s.position.left=i._convertPositionTo("relative",{top:0,left:c-i.helperProportions.width}).left-i.margins.left),P&&(s.position.left=i._convertPositionTo("relative",{top:0,left:f}).left-i.margins.left)}var b=u||m||v||P;if("outer"!=o.snapMode){var u=Math.abs(d-l)<=n,m=Math.abs(g-h)<=n,v=Math.abs(c-a)<=n,P=Math.abs(f-r)<=n;u&&(s.position.top=i._convertPositionTo("relative",{top:d,left:0}).top-i.margins.top),m&&(s.position.top=i._convertPositionTo("relative",{top:g-i.helperProportions.height,left:0}).top-i.margins.top),v&&(s.position.left=i._convertPositionTo("relative",{top:0,left:c}).left-i.margins.left),P&&(s.position.left=i._convertPositionTo("relative",{top:0,left:f-i.helperProportions.width}).left-i.margins.left)}!i.snapElements[p].snapping&&(u||m||v||P||b)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[p].item})),i.snapElements[p].snapping=u||m||v||P||b}else i.snapElements[p].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[p].item})),i.snapElements[p].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(e){e.preventDefault();var s=t(this).data("draggable").options,i=t.makeArray(t(s.stack.group)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||s.stack.min)-(parseInt(t(i).css("zIndex"),10)||s.stack.min)});t(i).each(function(t){this.style.zIndex=s.stack.min+t}),this[0].style.zIndex=s.stack.min+i.length}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,s){e.preventDefault();var i=t(s.helper),o=t(this).data("draggable").options;i.css("zIndex")&&(o._zIndex=i.css("zIndex")),i.css("zIndex",o.zIndex)},stop:function(e,s){e.preventDefault();var i=t(this).data("draggable").options;i._zIndex&&t(s.helper).css("zIndex",i._zIndex)}})}(jQuery);